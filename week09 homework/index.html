<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>Noto 1km Mesh Population Map</title>
	<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
	<link href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css" rel="stylesheet" />
	<style>
		body {
			margin: 0;
			padding: 0;
		}
		#map {
			width: 100%;
			height: 100vh;
		}
	</style>
</head>
<body>

	<!-- タイトルとサブタイトル -->
	<div style="position:absolute; top:10px; left:10px; z-index:1; background:white; padding:10px; border-radius:8px;">
		<h2 style="margin:0;">能登島1kmメッシュ人口分布図</h2>
		<p style="margin:0;">出典：統計メッシュデータ</p>
	</div>

	<!-- 凡例 -->
	<div style="position:absolute; bottom:20px; left:10px; background:white; padding:10px; font-size:12px; z-index:1; border-radius:6px;">
		<b>人口（人）</b><br>
		<span style="background:#015fb7; padding:2px 10px;"></span> 0〜500<br>
		<span style="background:#ffff02; padding:2px 10px;"></span> 500〜1000<br>
		<span style="background:#d97f00; padding:2px 10px;"></span> 1000〜1500<br>
		<span style="background:#ca06dc; padding:2px 10px;"></span> 1500〜2000<br>
        <span style="background:#ff0000; padding:2px 10px;"></span> 2000以上
	</div>

	<div id="map"></div>
	<script src="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.js"></script>
	<script>
		const map = new maplibregl.Map({
			container: 'map',
			style: 'https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json',
			center: [136.97465968589398, 37.04619165311153],
			zoom: 9
		});

		map.on('load', () => {
			map.addSource('tokyo', {
				type: 'geojson',
				data: 'Noto_population.geojson' // ← 自分のGeoJSONファイル名に合わせてね
			});

			map.addLayer({
				id: 'population-layer',
				type: 'fill',
				source: 'tokyo',
				paint: {
					'fill-color': [
						'interpolate',
						['linear'],
						['get', 'T001100001'], // 合計人口のフィールド名
						0, '#015fb7',
						500, '#ffff02',
						1000, '#d97f00',
						1500, '#ca06dc',
                        4000, '#ff0000'
					],
					'fill-opacity': 0.75,
					'fill-outline-color': '#ffffff'
				}
			});

			// ポップアップ表示（ホバー）
			map.on('mousemove', 'population-layer', (e) => {
				const props = e.features[0].properties;
				const population = props['T001100001'];
				const coordinates = e.lngLat;

				// すでにあるポップアップを削除
				document.querySelectorAll('.maplibregl-popup').forEach(el => el.remove());

				new maplibregl.Popup({ closeButton: false })
					.setLngLat(coordinates)
					.setHTML(`<strong>人口：</strong>${population}人`)
					.addTo(map);
			});

			map.on('mouseleave', 'population-layer', () => {
				document.querySelectorAll('.maplibregl-popup').forEach(el => el.remove());
			});
		});
	</script>
</body>
</html>
